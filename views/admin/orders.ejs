<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head') %>

<body>
  <div class="screen-overlay"></div>
  <%- include('./partials/sidebar') %>
  
  <main class="main-wrap">
    <%- include('./partials/header') %>
    
    <section class="content-main">
      <div class="content-header">
        <div>
          <h2 class="content-title card-title">Orders Management</h2>
          <p>List of all orders</p>
        </div>
      </div>

      <!-- Search, Filter, Sort Section -->
      <div class="card mb-4">
        <header class="card-header">
          <div class="row align-items-center">
            <div class="col-12">
              <form method="GET" action="/admin/orders" class="d-flex gap-2 flex-wrap">
                <div class="flex-grow-1">
                  <input type="text" class="form-control" name="search" placeholder="Search by Order ID" value="<%= search %>">
                </div>
                <div class="flex-shrink-0">
                  <select class="form-select" name="status">
                    <option value="">All Status</option>
                    <option value="Pending" <%= statusFilter === 'Pending' ? 'selected' : '' %>>Pending</option>
                    <option value="Shipped" <%= statusFilter === 'Shipped' ? 'selected' : '' %>>Shipped</option>
                    <option value="Delivered" <%= statusFilter === 'Delivered' ? 'selected' : '' %>>Delivered</option>
                    <option value="Cancelled" <%= statusFilter === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
                    <option value="ReturnRequested" <%= statusFilter === 'ReturnRequested' ? 'selected' : '' %>>Return Requested</option>
                    <option value="Returned" <%= statusFilter === 'Returned' ? 'selected' : '' %>>Returned</option>
                  </select>
                </div>
                <div class="flex-shrink-0">
                  <select class="form-select" name="sortBy">
                    <option value="date" <%= sortBy === 'date' ? 'selected' : '' %>>Sort by Date</option>
                    <option value="amount" <%= sortBy === 'amount' ? 'selected' : '' %>>Sort by Amount</option>
                  </select>
                </div>
                <div class="flex-shrink-0">
                  <select class="form-select" name="order">
                    <option value="desc" <%= order === -1 ? 'selected' : '' %>>Descending</option>
                    <option value="asc" <%= order === 1 ? 'selected' : '' %>>Ascending</option>
                  </select>
                </div>
                <div class="flex-shrink-0">
                  <button type="submit" class="btn btn-primary">Apply</button>
                  <a href="/admin/orders" class="btn btn-light">Clear</a>
                </div>
              </form>
            </div>
          </div>
        </header>
      </div>

      <!-- Orders Table -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Date</th>
                  <th>User</th>
                  <th>Email</th>
                  <th>Total</th>
                  <th>Status</th>
                  <th class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody>
                <% if(orders.length > 0) { %>
                  <% orders.forEach(order => { %>
                    <tr>
                      <td><strong><%= order.orderId %></strong></td>
                      <td><%= new Date(order.createdAt).toLocaleDateString() %></td>
                      <td><%= order.userId?.firstName || 'N/A' %></td>
                      <td><%= order.userId?.email || 'N/A' %></td>
                      <td><strong>â‚¹<%= order.total %></strong></td>
                      <td>
                        <span class="badge rounded-pill 
                          <%= order.status === 'Pending' ? 'alert-warning' 
                          : order.status === 'Shipped' ? 'alert-info' 
                          : order.status === 'Delivered' ? 'alert-success' 
                          : order.status === 'Cancelled' ? 'alert-danger' 
                          : order.status === 'ReturnRequested' ? 'alert-warning' 
                          : order.status === 'Returned' ? 'alert-secondary' 
                          : 'alert-primary' %>">
                          <%= order.status %>
                        </span>
                      </td>
                      <td class="text-end">
                        <a href="/admin/orders/<%= order.orderId %>" class="btn btn-sm btn-light">
                          View Details
                        </a>
                      </td>
                    </tr>
                  <% }) %>
                <% } else { %>
                  <tr>
                    <td colspan="7" class="text-center">No orders found</td>
                  </tr>
                <% } %>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <% if(totalPages > 1) { %>
            <nav>
              <ul class="pagination justify-content-center">
                <% if(currentPage > 1) { %>
                  <li class="page-item">
                    <a class="page-link" href="?page=<%= currentPage - 1 %>&search=<%= search %>&status=<%= statusFilter %>&sortBy=<%= sortBy %>&order=<%= order === 1 ? 'asc' : 'desc' %>">&laquo;</a>
                  </li>
                <% } %>
                
                <% for(let i = 1; i <= totalPages; i++) { %>
                  <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                    <a class="page-link" href="?page=<%= i %>&search=<%= search %>&status=<%= statusFilter %>&sortBy=<%= sortBy %>&order=<%= order === 1 ? 'asc' : 'desc' %>">
                      <%= i %>
                    </a>
                  </li>
                <% } %>
                
                <% if(currentPage < totalPages) { %>
                  <li class="page-item">
                    <a class="page-link" href="?page=<%= currentPage + 1 %>&search=<%= search %>&status=<%= statusFilter %>&sortBy=<%= sortBy %>&order=<%= order === 1 ? 'asc' : 'desc' %>">&raquo;</a>
                  </li>
                <% } %>
              </ul>
            </nav>
          <% } %>
        </div>
      </div>
    </section>

    <%- include('./partials/footer') %>
  </main>

  <script src="/admin/assets/js/vendors/jquery-3.6.0.min.js"></script>
  <script src="/admin/assets/js/bootstrap.bundle.min.js"></script>
  <script src="/admin/assets/js/main.js" type="text/javascript"></script>
</body>

</html>