<%- include('partials/head') %>

<style>
  :root {
    --primary-teal: #008B8B;
    --primary-teal-dark: #006B6B;
    --success-green: #28a745;
    --danger-red: #dc3545;
    --light-bg: #f8f9fa;
    --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  body {
    background-color: var(--light-bg);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  .wallet-container {
    max-width: 1000px;
    margin: 40px auto;
    padding: 20px;
  }

  .page-title {
    color: #333;
    font-size: 2rem;
    font-weight: 600;
    margin-bottom: 30px;
    padding-bottom: 15px;
    border-bottom: 3px solid var(--primary-teal);
  }

  /* Balance Card */
  .balance-card {
    background: linear-gradient(135deg, var(--primary-teal) 0%, var(--primary-teal-dark) 100%);
    border-radius: 16px;
    padding: 40px;
    color: white;
    box-shadow: 0 8px 24px rgba(0, 139, 139, 0.3);
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
  }

  .balance-card::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 200px;
    height: 200px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
  }

  .balance-card::after {
    content: '';
    position: absolute;
    bottom: -30%;
    left: -5%;
    width: 150px;
    height: 150px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
  }

  .balance-content {
    position: relative;
    z-index: 1;
  }

  .balance-label {
    font-size: 1rem;
    opacity: 0.9;
    margin-bottom: 10px;
    font-weight: 500;
  }

  .balance-amount {
    font-size: 3rem;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .wallet-icon {
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .wallet-icon svg {
    width: 30px;
    height: 30px;
  }

  /* Transactions Section */
  .transactions-card {
    background: white;
    border-radius: 16px;
    box-shadow: var(--card-shadow);
    overflow: hidden;
  }

  .transactions-header {
    background: linear-gradient(135deg, var(--primary-teal) 0%, var(--primary-teal-dark) 100%);
    color: white;
    padding: 20px 25px;
  }

  .transactions-header h3 {
    margin: 0;
    font-size: 1.3rem;
    font-weight: 600;
  }

  .transactions-body {
    padding: 25px;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #999;
  }

  .empty-state svg {
    width: 80px;
    height: 80px;
    color: #ddd;
    margin-bottom: 20px;
  }

  .empty-state h4 {
    color: #666;
    margin-bottom: 10px;
  }

  .empty-state p {
    color: #999;
    font-size: 0.95rem;
  }

  /* Transaction Table */
  .transaction-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }

  .transaction-table thead th {
    background: #f8f9fa;
    padding: 15px;
    text-align: left;
    font-weight: 600;
    color: #555;
    font-size: 0.9rem;
    border-bottom: 2px solid #e0e0e0;
  }

  .transaction-table tbody tr {
    border-bottom: 1px solid #f0f0f0;
    transition: background 0.2s ease;
  }

  .transaction-table tbody tr:hover {
    background: #f8f9fa;
  }

  .transaction-table tbody td {
    padding: 18px 15px;
    color: #333;
  }

  .transaction-date {
    color: #666;
    font-size: 0.9rem;
  }

  .transaction-type {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .transaction-type.credit {
    background: #d4edda;
    color: #155724;
  }

  .transaction-type.debit {
    background: #f8d7da;
    color: #721c24;
  }

  .transaction-type svg {
    width: 14px;
    height: 14px;
  }

  .transaction-amount {
    font-weight: 700;
    font-size: 1.1rem;
  }

  .transaction-amount.credit {
    color: var(--success-green);
  }

  .transaction-amount.debit {
    color: var(--danger-red);
  }

  .transaction-reason {
    color: #666;
    font-size: 0.9rem;
  }

  @media (max-width: 768px) {
    .wallet-container {
      padding: 15px;
    }

    .page-title {
      font-size: 1.5rem;
    }

    .balance-card {
      padding: 30px 20px;
    }

    .balance-amount {
      font-size: 2rem;
    }

    .transaction-table {
      font-size: 0.85rem;
    }

    .transaction-table thead {
      display: none;
    }

    .transaction-table tbody tr {
      display: block;
      margin-bottom: 15px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
    }

    .transaction-table tbody td {
      display: block;
      padding: 8px 0;
      border: none;
    }

    .transaction-table tbody td::before {
      content: attr(data-label);
      font-weight: 600;
      display: inline-block;
      width: 100px;
      color: #666;
    }
  }
</style>

<body>
  <%- include('partials/header') %>

  <div class="wallet-container">
    <h2 class="page-title">ðŸ’° My Wallet</h2>

    <!-- Balance Card -->
    <div class="balance-card">
      <div class="balance-content">
        <div class="balance-label">Available Balance</div>
        <div class="balance-amount">
          <div class="wallet-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
              <path d="M1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1H1zm7 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
              <path d="M0 5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V5zm3 0a2 2 0 0 1-2 2v4a2 2 0 0 1 2 2h10a2 2 0 0 1 2-2V7a2 2 0 0 1-2-2H3z"/>
            </svg>
          </div>
          â‚¹<%= balance.toFixed(2) %>
        </div>
      </div>
    </div>


    <div style="text-align:right; margin-bottom:20px;">
  <button id="addMoneyBtn" class="btn btn-success">Add Money</button>
</div>






    <!-- Transactions Card -->
    <div class="transactions-card">
      <div class="transactions-header">
        <h3>ðŸ“‹ Transaction History</h3>
      </div>
      <div class="transactions-body">
        <% if (transactions && transactions.length > 0) { %>
          <table class="transaction-table">
            <thead>
              <tr>
                <th>Date & Time</th>
                <th>Type</th>
                <th>Amount</th>
                <th>Reason</th>
              </tr>
            </thead>
            <tbody>
              <% transactions.slice().reverse().forEach(transaction => { %>
                <tr>
                  <td data-label="Date">
                    <div class="transaction-date">
                      <%= new Date(transaction.createdAt).toLocaleDateString('en-IN', { 
                        day: '2-digit', 
                        month: 'short', 
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                      }) %>
                    </div>
                  </td>
                  <td data-label="Type">
                    <span class="transaction-type <%= transaction.type.toLowerCase() %>">
                      <% if (transaction.type === 'Credit') { %>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                          <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                        </svg>
                      <% } else { %>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                          <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
                        </svg>
                      <% } %>
                      <%= transaction.type %>
                    </span>
                  </td>
                  <td data-label="Amount">
                    <div class="transaction-amount <%= transaction.type.toLowerCase() %>">
                      <%= transaction.type === 'Credit' ? '+' : '-' %>â‚¹<%= transaction.amount.toFixed(2) %>
                    </div>
                  </td>
                  <td data-label="Reason">
                    <div class="transaction-reason">
                      <%= transaction.reason %>
                    </div>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } else { %>
          <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
              <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/>
            </svg>
            <h4>No Transactions Yet</h4>
            <p>Your wallet transaction history will appear here</p>
          </div>
        <% } %>
      </div>
    </div>
  </div>


<% if (typeof error !== 'undefined' && error) { %>
<script>
  Swal.fire({
    icon: 'error',
    title: 'Oops...',
    text: '<%= error %>',
    confirmButtonColor: '#008B8B'
  });
</script>
<% } %>


<script>
document.getElementById('addMoneyBtn').addEventListener('click', async () => {
  const { value: amount } = await Swal.fire({
    title: 'Add Money to Wallet',
    input: 'number',
    inputLabel: 'Enter amount (â‚¹)',
    inputPlaceholder: 'Enter amount to add',
    confirmButtonText: 'Add',
    confirmButtonColor: '#008B8B',
    showCancelButton: true
  });

  if (amount && amount > 0) {
    try {
      const res = await fetch('/wallet/add-money', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ amount })
      });

      const data = await res.json();
      console.log('Response:', data); // âœ… check this in browser console

      if (data.success) {
        Swal.fire({
          icon: 'success',
          title: 'Success!',
          text: `â‚¹${amount} added successfully!`,
          confirmButtonColor: '#008B8B'
        }).then(() => location.reload());
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Oops...',
          text: data.message || 'Failed to add money.',
          confirmButtonColor: '#008B8B'
        });
      }
    } catch (error) {
      console.error('Error:', error);
      Swal.fire('Error', 'Something went wrong.', 'error');
    }
  }
});
</script>



  <%- include('partials/footer') %>
  
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>
</html>