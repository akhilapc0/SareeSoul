<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head') %>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/elevatezoom/3.0.8/jquery.elevatezoom.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f8f9fa;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .breadcrumb {
      padding: 15px 0;
      background: white;
      border-bottom: 1px solid #e9ecef;
      font-size: 0.9rem;
      color: #6c757d;
    }

    .breadcrumb a {
      color: #2874f0;
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .product-section {
      background: white;
      margin: 20px 0;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .product-grid {
      display: grid;
      grid-template-columns: 500px 1fr;
      gap: 50px;
      align-items: start;
    }

    .image-gallery {
      position: sticky;
      top: 20px;
    }

    .main-image-container {
      position: relative;
      width: 65%;
      aspect-ratio: 1 / 1.5;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
      background: white;
    }

    .main-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      cursor: zoom-in;
      display: block;
    }

    .zoomContainer {
      z-index: 999;
      position: absolute;
    }

    .zoomWrapper {
      position: relative;
      overflow: hidden;
    }

    .zoomLens {
      border: 2px solid rgba(0, 0, 0, 0.2);
      cursor: zoom-in;
    }

    .thumbnail-container {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding: 10px 0;
    }

    .thumbnail {
      aspect-ratio: 1 / 1.5;
      width: 80px;
      height: auto;
      border: 2px solid transparent;
      border-radius: 6px;
      cursor: pointer;
      object-fit: cover;
      max-width: 80px;
      opacity: 0.6;
      transition: opacity 0.3s ease, border-color 0.2s ease, transform 0.2s ease;
      flex-shrink: 0;
    }

    .thumbnail:hover,
    .thumbnail.active {
      opacity: 1;
      border-color: #2874f0;
      transform: scale(1.05);
    }

    .product-info {
      padding-left: 20px;
    }

    .product-title {
      font-size: 1.8rem;
      font-weight: 500;
      color: #212529;
      margin-bottom: 10px;
      line-height: 1.3;
    }

    .brand-category {
      color: #878787;
      margin-bottom: 15px;
      font-size: 0.95rem;
    }

    .brand-category a {
      color: #2874f0;
      text-decoration: none;
    }

    .rating-section {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .rating-badge {
      background: #388e3c;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .rating-text {
      color: #878787;
      font-size: 0.9rem;
    }

    .price-section {
      margin-bottom: 25px;
      padding: 20px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .current-price {
      font-size: 2rem;
      font-weight: 500;
      color: #212529;
      margin-right: 10px;
    }

    .original-price {
      font-size: 1.2rem;
      color: #878787;
      text-decoration: line-through;
      margin-right: 10px;
    }

    .discount-badge {
      color: #388e3c;
      font-size: 1rem;
      font-weight: 500;
    }

    .price-details {
      font-size: 0.9rem;
      color: #878787;
      margin-top: 8px;
    }

    .variants-section {
      margin-bottom: 30px;
    }

    .variants-title {
      font-size: 1.1rem;
      font-weight: 500;
      margin-bottom: 15px;
      color: #212529;
    }

    .color-options {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .color-option {
      position: relative;
      width: 50px;
      height: 50px;
      border: 3px solid #e0e0e0;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
      overflow: hidden;
    }

    .color-option:hover {
      transform: scale(1.1);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .color-option.active {
      border-color: #2874f0;
      box-shadow: 0 0 0 2px #2874f0;
    }

    .color-option img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      max-width: 50px;
      max-height: 50px;
    }

    .color-name {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.8rem;
      color: #666;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .color-option:hover .color-name,
    .color-option.active .color-name {
      opacity: 1;
    }

    .selected-color {
      font-weight: 500;
      color: #2874f0;
    }

    .stock-section {
      margin-bottom: 25px;
    }

    .stock-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .stock-status.in-stock {
      background: #e8f5e8;
      color: #2e7d32;
    }

    .stock-status.low-stock {
      background: #fff3e0;
      color: #f57c00;
    }

    .stock-status.out-of-stock {
      background: #ffebee;
      color: #d32f2f;
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
    }

    .btn {
      padding: 15px 40px;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-width: 200px;
    }

    .btn-primary {
      background: #ff9f00;
      color: white;
    }

    .btn-primary:hover {
      background: #e68900;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: #2874f0;
      color: white;
    }

    .btn-secondary:hover {
      background: #1e5bc6;
      transform: translateY(-1px);
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .features-section {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 8px;
      margin: 30px 0;
    }

    .features-title {
      font-size: 1.2rem;
      font-weight: 500;
      margin-bottom: 20px;
      color: #212529;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .feature-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 0;
    }

    .feature-icon {
      font-size: 1.2rem;
      color: #2874f0;
    }

    .feature-text {
      font-size: 0.95rem;
      color: #555;
    }

    .description-section {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 1px solid #e9ecef;
    }

    .description-title {
      font-size: 1.3rem;
      font-weight: 500;
      margin-bottom: 15px;
      color: #212529;
    }

    .description-text {
      font-size: 1rem;
      line-height: 1.8;
      color: #555;
    }

    .mobile-zoom-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: center;
    }

    .mobile-zoom-overlay img {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
    }

    @media (max-width: 1024px) {
      .product-grid {
        grid-template-columns: 1fr;
        gap: 30px;
      }

      .zoomContainer {
        display: none !important;
      }

      .image-gallery {
        position: relative;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 15px;
      }

      .product-section {
        padding: 20px;
        margin: 10px 0;
      }

      .main-image-container {
        height: 350px;
      }

      .product-title {
        font-size: 1.5rem;
      }

      .current-price {
        font-size: 1.5rem;
      }

      .action-buttons {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }

      .product-info {
        padding-left: 0;
      }
    }

    .loading {
      opacity: 0.7;
      pointer-events: none;
    }

    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .zoom-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .zoom-overlay img {
      max-width: 90%;
      max-height: 90%;
      cursor: zoom-out;
    }
  </style>
</head>

<body>
  <%- include('./partials/header') %>

  <div class="container">
    <div class="breadcrumb">
      <a href="/">Home</a> / 
      <a href="/products">Products</a> / 
      <% if (category) { %>
        <a href="/category/<%= category._id %>"><%= category.name %></a> /
      <% } %>
      <span><%= product.name %></span>
    </div>

    <div class="product-section">
      <div class="product-grid">
        <div class="image-gallery">
          <div class="main-image-container" id="imageContainer">
            <% if (variants.length > 0 && variants[0].images.length > 0) { %>
              <img 
                src="<%= variants[0].images[0] %>" 
                alt="<%= product.name %>"
                class="main-image"
                id="mainImage"
              >
            <% } %>
          </div>
          
          <div class="thumbnail-container" id="thumbnailContainer">
            <% if (variants.length > 0) { %>
              <% variants[0].images.forEach((image, index) => { %>
                <img 
                  src="<%= image %>" 
                  alt="<%= product.name %> - View <%= index + 1 %>"
                  class="thumbnail <%= index === 0 ? 'active' : '' %>"
                  onclick="changeMainImage('<%= image %>', this)"
                >
              <% }) %>
            <% } %>
          </div>
        </div>

        <div class="product-info">
          <h1 class="product-title"><%= product.name %></h1>
          
          <div class="brand-category">
            <% if (brand) { %>
              Brand: <a href="/brand/<%= brand._id %>"><%= brand.name %></a>
            <% } %>
            <% if (category && brand) { %> | <% } %>
            <% if (category) { %>
              Category: <a href="/category/<%= category._id %>"><%= category.name %></a>
            <% } %>
          </div>

          <div class="rating-section">
            <div class="rating-badge">
              <span>‚òÖ</span>
              <span><%= product.rating || 4.2 %></span>
            </div>
            <span class="rating-text">Based on customer reviews</span>
          </div>

          <div class="price-section">
            <span class="current-price">‚Çπ<span id="currentPrice"><%= product.salesPrice %></span></span>
            <% if (product.actualPrice > product.salesPrice) { %>
              <span class="original-price">‚Çπ<%= product.actualPrice %></span>
              <span class="discount-badge">
                <%= Math.round(((product.actualPrice - product.salesPrice) / product.actualPrice) * 100) %>% off
              </span>
            <% } %>
            <div class="price-details">Inclusive of all taxes</div>
          </div>

          <% if (variants.length > 1) { %>
            <div class="variants-section">
              <div class="variants-title">
                Color: <span class="selected-color" id="selectedColor"><%= variants[0].colour %></span>
              </div>
              <div class="color-options">
                <% variants.forEach((variant, index) => { %>
                  <div 
                    class="color-option <%= index === 0 ? 'active' : '' %>"
                    data-variant-index="<%= index %>"
                    onclick="selectVariant(<%= index %>)"
                    title="<%= variant.colour %>"
                  >
                    <img src="<%= variant.images[0] %>" alt="<%= variant.colour %>">
                    <div class="color-name"><%= variant.colour %></div>
                  </div>
                <% }) %>
              </div>
            </div>
          <% } %>

          <div class="stock-section">
            <% if (variants.length > 0) { %>
              <div class="stock-status <%= variants[0].stock > 10 ? 'in-stock' : variants[0].stock > 0 ? 'low-stock' : 'out-of-stock' %>" id="stockStatus">
                <% if (variants[0].stock > 10) { %>
                  ‚úì In Stock
                <% } else if (variants[0].stock > 0) { %>
                  ‚ö† Only <%= variants[0].stock %> left
                <% } else { %>
                  ‚úó Out of Stock
                <% } %>
              </div>
            <% } %>
          </div>

          <div class="action-buttons">
            <button class="btn btn-primary"  id="addToCartBtn" >
              <i class="bi bi-cart-plus"></i> Add to Cart

            </button>
            <button class="btn btn-secondary">
              <i class="bi bi-lightning"></i> Buy Now
            </button>
            <button class="btn btn-outline-secondary" id="addToWishlistBtn">
>
              <i class="bi bi-heart"></i> Add to Wishlist
            </button>
          </div>

          <div class="features-section">
            <div class="features-title">Why choose this product?</div>
            <div class="features-grid">
              <div class="feature-item">
                <span class="feature-icon">üöö</span>
                <span class="feature-text">Free Delivery</span>
              </div>
              <div class="feature-item">
                <span class="feature-icon">üîÑ</span>
                <span class="feature-text">7 Day Return Policy</span>
              </div>
              <div class="feature-item">
                <span class="feature-icon">üí≥</span>
                <span class="feature-text">Cash on Delivery</span>
              </div>
              <div class="feature-item">
                <span class="feature-icon">üõ°Ô∏è</span>
                <span class="feature-text">1 Year Warranty</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="description-section">
        <h2 class="description-title">Product Description</h2>
        <div class="description-text">
          <%= product.description %>
        </div>
      </div>
    </div>
  </div>

  <%- include('./partials/footer') %>

  <div class="zoom-overlay" id="zoomOverlay">
    <img id="zoomedImage" src="" alt="Zoomed Image">
    <button class="close-zoom btn btn-light position-absolute top-0 end-0 m-3">
      <i class="bi bi-x-lg"></i>
    </button>
  </div>

  <script>
    let currentVariantIndex = 0;
    const variants = <%- JSON.stringify(variants) %>;
    const product = <%- JSON.stringify(product) %>;
    const wishlistItems=<%- JSON.stringify(wishlistVariantIds  || [])%>;
    const cartItems=<%- JSON.stringify(cartItems || [] )%>;

        const MAX_LIMIT=5;
    //initialize zoom
    function initImageZoom() {
      if ($('#mainImage').data('elevateZoom')) {
        $('.zoomContainer').remove();
        $('#mainImage').removeData('elevateZoom');
      }
      if ($(window).width() <= 768) {
        setupMobileZoom();
      } else {
        setupDesktopZoom();
      }
    }

    function setupDesktopZoom() {
      const $mainImage = $('#mainImage');
      const $container = $('#imageContainer');

      console.log('Initializing zoom for image:', $mainImage.attr('src'));

      if ($mainImage[0].complete) {
        initializeZoom();
      } else {
        $mainImage.on('load', initializeZoom);
      }

      function initializeZoom() {
        const rect = $mainImage[0].getBoundingClientRect();
        const displayedWidth = rect.width;
        const displayedHeight = rect.height;

        console.log('Image dimensions:', { width: displayedWidth, height: displayedHeight });

        $mainImage.elevateZoom({
          zoomType: "lens",
          lensShape: "square",
          lensSize: 150,
          borderSize: 1,
          zoomWindowWidth: displayedWidth * 1.5,
          zoomWindowHeight: displayedHeight * 1.5,
          zoomLevel: 1.5,
          scrollZoom: true
        });

        $mainImage.off('load', initializeZoom);
      }
    }

    function setupMobileZoom() {
      if ($('#mobile-zoom-overlay').length === 0) {
        $('body').append(`
          <div id="mobile-zoom-overlay" class="mobile-zoom-overlay">
            <img id="mobile-zoomed-image" src="" alt="Zoomed Image">
            <button class="close-zoom btn btn-light position-absolute top-0 end-0 m-3">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
        `);
      }
      $('#mainImage').off('click').on('click', function() {
        $('#mobile-zoomed-image').attr('src', $(this).attr('src'));
        $('#mobile-zoom-overlay').fadeIn('fast');
      });
      $(document).off('click', '#mobile-zoom-overlay .close-zoom').on('click', '#mobile-zoom-overlay .close-zoom', function() {
        $('#mobile-zoom-overlay').fadeOut('fast');
      });
    }

    //fallback Zoom
    function setupFallbackZoom() {
      const $mainImage = $('#mainImage');
      $mainImage.off('click').on('click', function() {
        const $zoomOverlay = $('#zoomOverlay');
        const $zoomedImage = $('#zoomedImage');
        $zoomedImage.attr('src', $mainImage.attr('src'));
        $zoomOverlay.fadeIn('fast');

        $(document).off('click', '#zoomOverlay .close-zoom').on('click', '#zoomOverlay .close-zoom', function() {
          $zoomOverlay.fadeOut('fast');
        });
      });
    }

    //change main image
    function changeMainImage(src, thumbnail) {
      const mainImage = $('#mainImage');
      mainImage.addClass('loading');
      mainImage.attr('src', src);

      console.log('Changing image to:', src);

      // update active thumbnail
      $('.thumbnail').removeClass('active');
      $(thumbnail).addClass('active');

      // reinitialize zoom after image load
      mainImage.on('load', function() {
        initImageZoom();
        if ($('#mainImage').data('elevateZoom')) {
          console.log('ElevateZoom initialized successfully');
        } else {
          console.log('ElevateZoom failed, using fallback');
          setupFallbackZoom();
        }
        mainImage.removeClass('loading').addClass('fade-in');
        setTimeout(() => {
          mainImage.removeClass('fade-in');
        }, 300);
        mainImage.off('load');
      });
    }

    //select variant (color)
    function selectVariant(index) {
      currentVariantIndex = index;
      const variant = variants[index];

      if (!variant) return;

      //update active color option
      $('.color-option').removeClass('active');
      $(`[data-variant-index="${index}"]`).addClass('active');

      //update selected color text
      $('#selectedColor').text(variant.colour);

      //update main image with fade effect
      const mainImage = $('#mainImage');
      mainImage.addClass('loading');

      setTimeout(() => {
        if (variant.images && variant.images.length > 0) {
          mainImage.attr('src', variant.images[0]);

          //update thumbnails
          updateThumbnails(variant.images);

          //reinitialize zoom after image load
          mainImage.on('load', function() {
            initImageZoom();
            if ($('#mainImage').data('elevateZoom')) {
              console.log('ElevateZoom initialized successfully for variant');
            } else {
              console.log('ElevateZoom failed for variant, using fallback');
              setupFallbackZoom();
            }
            mainImage.removeClass('loading').addClass('fade-in');
            setTimeout(() => {
              mainImage.removeClass('fade-in');
            }, 300);
            mainImage.off('load');
          });
        } else {
          mainImage.removeClass('loading');
        }

        //update stock status
        updateStockStatus(variant.stock);

          UpdateAddToCartButton();
          updateWishlistButton();
      }, 150);
    }

    //update thumbnails
    function updateThumbnails(images) {
      const thumbnailContainer = $('#thumbnailContainer');
      thumbnailContainer.html(images.map((image, index) => `
        <img 
          src="${image}" 
          alt="Product View ${index + 1}"
          class="thumbnail ${index === 0 ? 'active' : ''}"
          onclick="changeMainImage('${image}', this)"
        >
      `).join(''));
    }

    //update stock status
    function updateStockStatus(stock) {
      const stockStatus = $('#stockStatus');
      if (stock > 10) {
        stockStatus.removeClass('low-stock out-of-stock').addClass('in-stock').html('‚úì In Stock');
      } else if (stock > 0) {
        stockStatus.removeClass('in-stock out-of-stock').addClass('low-stock').html(`‚ö† Only ${stock} left`);
      } else {
        stockStatus.removeClass('in-stock low-stock').addClass('out-of-stock').html('‚úó Out of Stock');
      }
    }

    function updateAddToCartButton() {
    const selectedVariant = variants[currentVariantIndex];
    const addToCartBtn = $('#addToCartBtn');

    const cartItem = cartItems.find(item => item.variantId === selectedVariant._id);
    const quantityInCart = cartItem ? cartItem.quantity : 0;

    if (selectedVariant.stock === 0) {
      addToCartBtn.prop('disabled', true).text('üö´ Out of Stock');
    } else if (quantityInCart >= Math.min(selectedVariant.stock, MAX_LIMIT)) {
      addToCartBtn.prop('disabled', true).text('‚ö† Limit Reached');
    } else {
      addToCartBtn.prop('disabled', false).html('<i class="bi bi-cart-plus"></i> Add to Cart');
    }
  }

      function updateWishlistButton() {
  const selectedVariant = variants[currentVariantIndex];
  const addToWishlistBtn = $('#addToWishlistBtn');

  const inWishlist = wishlistItems.some(item => item.variantId === selectedVariant._id);
  const inCart = cartItems.some(item => item.variantId === selectedVariant._id);

  if (inCart) {
    addToWishlistBtn.prop('disabled', true).text('‚úî In Cart');
  } 
  else if (inWishlist) {
    addToWishlistBtn.prop('disabled', true).text('‚úî In Wishlist');
  } 
  else {
    addToWishlistBtn.prop('disabled', false).html('<i class="bi bi-heart"></i> Add to Wishlist');
  }
}



    //initialize when page loads
    $(document).ready(function() {
      // Preload images for better performance
      variants.forEach(variant => {
        variant.images.forEach(image => {
          const img = new Image();
          img.src = image;
        });
      });

      //initialize zoom
      const mainImage = $('#mainImage');
      if (mainImage[0].complete) {
        initImageZoom();
        if (!$('#mainImage').data('elevateZoom')) {
          console.log('Initial ElevateZoom failed, using fallback');
          setupFallbackZoom();
        }
      } else {
        mainImage.on('load', function() {
          initImageZoom();
          if (!$('#mainImage').data('elevateZoom')) {
            console.log('Initial ElevateZoom failed, using fallback');
            setupFallbackZoom();
          }
          mainImage.off('load');
        });
      }

      //update first thumbnail as active
      $('.thumbnail').first().addClass('active');

      //direct resize handler
      $(window).on('resize', initImageZoom);
    });

    updateAddToCartButton();
    updateWishlistButton();
    
    document.getElementById('addToCartBtn').addEventListener('click', async function() {
  const selectedVariant = variants[currentVariantIndex];
  
  if (!selectedVariant || selectedVariant.stock === 0) {
    Swal.fire({
      icon: 'error',
      title: 'Out of Stock',
      text: 'This product is currently out of stock'
    });
    return;
  }

  try {
    const response = await fetch('/cart', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        productId: product._id,
        variantId: selectedVariant._id,
        quantity: 1
      })
    });

    const data = await response.json();

    if (response.ok) {
  cartItems.push({ variantId: selectedVariant._id, quantity: 1 }); // Update local list
  updateWishlistButton(); // Disable wishlist button
  Swal.fire({
    icon: 'success',
    title: 'Added to Cart',
    text: data.message,
    timer: 1500
  });
}

     else {
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: data.message
      });
    }
  } catch (error) {
    console.error('Error:', error);
    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: 'Failed to add to cart'
    });
  }
});

document.getElementById('addToWishlistBtn').addEventListener('click', async function() {
  const selectedVariant = variants[currentVariantIndex];

  if (!selectedVariant) {
    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: 'Variant not selected'
    });
    return;
  }

  try {
    const response = await fetch('/add', {  
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        productId: product._id,
        variantId: selectedVariant._id
      })
    });

    const data = await response.json();

    if (response.ok) {
      Swal.fire({
        icon: 'success',
        title: 'Added to Wishlist',
        text: data.message,
        timer: 1500
      });
    } else {
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: data.message
      });
    }
  } catch (error) {
    console.error('Wishlist Error:', error);
    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: 'Failed to add to wishlist'
    });
  }
});

  </script>
</body>
</html>