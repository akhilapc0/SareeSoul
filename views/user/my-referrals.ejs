<%- include('partials/head') %>

<style>
  .referral-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 30px 15px;
  }

  .referral-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 40px;
    border-radius: 15px;
    margin-bottom: 30px;
    text-align: center;
  }

  .referral-code-box {
    background: rgba(255, 255, 255, 0.2);
    padding: 20px;
    border-radius: 10px;
    margin-top: 20px;
  }

  .referral-code {
    font-size: 2rem;
    font-weight: bold;
    letter-spacing: 3px;
    margin: 10px 0;
  }

  .stats-card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: center;
    margin-bottom: 30px;
  }

  .stat-number {
    font-size: 3rem;
    font-weight: bold;
    color: #667eea;
  }

  .stat-label {
    color: #666;
    font-size: 1.1rem;
    margin-top: 10px;
  }

  .referral-table {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow: hidden;
  }

  .referral-table table {
    width: 100%;
    border-collapse: collapse;
  }

  .referral-table th {
    background: #f8f9fa;
    padding: 15px;
    text-align: left;
    font-weight: 600;
    color: #333;
    border-bottom: 2px solid #dee2e6;
  }

  .referral-table td {
    padding: 15px;
    border-bottom: 1px solid #dee2e6;
    color: #666;
  }

  .referral-table tbody tr:hover {
    background: #f8f9fa;
  }

  .badge-success {
    background: #28a745;
    color: white;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #999;
  }

  .empty-state i {
    font-size: 4rem;
    margin-bottom: 20px;
    color: #ddd;
  }

  .btn-copy {
    background: white;
    color: #667eea;
    border: 2px solid white;
    padding: 10px 30px;
    border-radius: 25px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn-copy:hover {
    background: #667eea;
    color: white;
  }

  .info-box {
    background: #e7f3ff;
    border-left: 4px solid #2196F3;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 30px;
  }

  .info-box h5 {
    color: #1976D2;
    margin-bottom: 10px;
  }

  .info-box p {
    color: #555;
    margin: 0;
  }
</style>

<body>
  <%- include('partials/header') %>

  <div class="referral-container">
    
    <!-- Header Section -->
    <div class="referral-header">
      <h1>üéÅ My Referral Program</h1>
      <p>Invite friends and earn ‚Çπ100 for each successful referral!</p>
      
      <div class="referral-code-box">
        <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Your Referral Link:</p>
        <div class="referral-code" id="referralLink"><%= BASE_URL %>/register?ref=<%= referralCode %>
</div>
        <button class="btn-copy" onclick="copyReferralLink()">
          <i class="fas fa-copy"></i> Copy Link
        </button>
      </div>
    </div>

    <!-- How It Works -->
    <div class="info-box">
      <h5>üí° How It Works:</h5>
      <p>
        1. Share your referral code with friends<br>
        2. They enter your code during registration<br>
        3. When they verify their account, you get ‚Çπ100 in your wallet!<br>
        4. Use your wallet balance on any purchase
      </p>
    </div>

    <!-- Stats Section -->
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="stats-card">
          <div class="stat-number"><%= totalReferrals %></div>
          <div class="stat-label">Total Successful Referrals</div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="stats-card">
          <div class="stat-number">‚Çπ<%= totalEarnings %></div>
          <div class="stat-label">Total Earned</div>
        </div>
      </div>
    </div>

    <!-- Referrals Table -->
    <div class="referral-table">
      <div style="padding: 20px; background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
        <h5 style="margin: 0; color: #333;">üë• Your Referrals</h5>
      </div>
      
      <% if (referrals.length === 0) { %>
        <div class="empty-state">
          <i class="fas fa-user-friends"></i>
          <h3>No Referrals Yet</h3>
          <p>Share your referral code with friends to start earning rewards!</p>
          <p class="mt-3">
            <strong>Your Code:</strong> <%= referralCode %>
          </p>
        </div>
      <% } else { %>
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Email</th>
              <th>Joined Date</th>
              <th>Reward</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <% referrals.forEach((referral, index) => { %>
              <tr>
                <td><%= index + 1 %></td>
                <td><%= referral.firstName %> <%= referral.lastName %></td>
                <td><%= referral.email %></td>
                <td><%= new Date(referral.createdAt).toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' }) %></td>
                <td><strong>‚Çπ100</strong></td>
                <td><span class="badge-success">‚úì Credited</span></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } %>
    </div>

    <!-- View Wallet Button -->
    <div class="text-center mt-4">
      <a href="/wallet" class="btn btn-primary btn-lg">
        <i class="fas fa-wallet"></i> View My Wallet
      </a>
    </div>

  </div>

  <%- include('partials/footer') %>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>

    function copyReferralLink() {
  const link = document.getElementById('referralLink').innerText;
  navigator.clipboard.writeText(link).then(() => {
    Swal.fire({
      icon: 'success',
      title: 'Copied!',
      text: `Referral link copied to clipboard`,
      timer: 2000,
      showConfirmButton: false
    });
  });
}

  </script>

</body>
</html>